{% extends "AdminVideos/base.html" %}
  
{% block pestanias-menues-platos %}

<!-- PESTAÑAS - MENÚES PROGRAMADOS - PLATOS -->

<!-- Tab Content -->
<div class="tab-content bg-white" id="diasTabContent">

  {% for dia in dias_desde_hoy %}
  <div class="tab-pane {% if dia_activo == dia|date:'Y-m-d' %}active{% elif forloop.first and not dia_activo %}active{% endif %}"
       id="tab-content-{{ dia|date:'Y-m-d' }}" role="tabpanel" aria-labelledby="tab-{{ dia|date:'Y-m-d' }}">

    <div class="text-dark p-1 small">
      <div class="position-relative">

        <div class="border border-2 border-primary rounded p-2 mt-2 bg-light shadow-sm">
          <div class="row align-items-start">
            <div class="col py-2">

              {% if dia in platos_dia_x_dia %}
                <!-- Si hay platos programados para este día, los mostramos -->
                {% for dia_plato in platos_dia_x_dia.items %}
                  {% if dia_plato.0 == dia %}

                   
             {# ========================= #}
{# DESKTOP / TABLET: 4 columnas #}
{# ========================= #}
<div class="d-none d-md-block">
  <div class="row gx-0">

    <!-- Desayuno -->
    <div class="col-md-3">
      <h6 class="fw-bold ms-1 bg-primary text-white p-1 rounded">Desayuno</h6>

      {% if dia_plato.1.desayuno %}
        {% for plato in dia_plato.1.desayuno %}

          {% if plato.objeto_id %}

            <div class="mb-1 ms-1 d-flex align-items-center text-primary justify-content-between">
              <!-- Nombre (link solo si NO es lugar) -->
              {% if not plato.es_lugar %}
                <a href="{% url 'videos-update' plato.objeto_id %}" class="text-decoration-none me-2 w-75">
                  &nbsp; {{ plato.nombre }}
                </a>
              {% else %}
                <span class="me-2 w-75">&nbsp; {{ plato.nombre }}</span>
              {% endif %}

              <!-- Íconos -->
              <div class="d-flex">
                
                  <a href="{% url 'fijar-o-eliminar-habito' plato.es_lugar|yesno:'1,0' plato.objeto_id 'desayuno' %}"
                    title="{% if plato.fijo %}Eliminar hábito{% else %}Fijar hábito{% endif %}"
                    class="ms-2">
                    <i class="bi bi-pin-angle-fill fa-lg {% if plato.fijo %}text-success{% else %}text-secondary{% endif %}"></i>
                  </a>

                {# Eliminar: manda es_lugar (1/0) + objeto_id #}
                <a href="{% url 'eliminar-programado' plato.es_lugar|yesno:'1,0' plato.objeto_id 'desayuno' dia %}"
                   class="btn btn-sm p-0 ms-2" title="Eliminar">
                  <i class="fa-solid fa-trash-can"></i>
                </a>
              </div>
            </div>

            <!-- Extras solo si NO es lugar y es Principal -->
            {% if not plato.es_lugar and 'Principal' in plato.tipo %}
              <div class="ms-5">
                <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                        id="agregar-salsa-{{ plato.objeto_id }}">
                  + Salsa
                </button>
                <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                        id="agregar-guarnicion-{{ plato.objeto_id }}">
                  + Guarnición
                </button>
              </div>
            {% endif %}

          {% else %}
            <p class="mb-1 ms-1 d-flex align-items-center text-danger">
              Este objeto no tiene ID válido.
            </p>
          {% endif %}

        {% endfor %}
      {% else %}
        <p class="mb-1 ms-1 d-flex align-items-center">No hay platos programados.</p>
      {% endif %}
    </div>

    <!-- Almuerzo -->
    <div class="col-md-3">
      <h6 class="fw-bold ms-1 bg-primary text-white p-1 rounded">Almuerzo</h6>

      {% if dia_plato.1.almuerzo %}
        {% for plato in dia_plato.1.almuerzo %}

          {% if plato.objeto_id %}

            <div class="mb-1 ms-1 d-flex align-items-center text-primary justify-content-between">
              {% if not plato.es_lugar %}
                <a href="{% url 'videos-update' plato.objeto_id %}" class="text-decoration-none me-2 w-75">
                  &nbsp; {{ plato.nombre }}
                </a>
              {% else %}
                <span class="me-2 w-75">&nbsp; {{ plato.nombre }}</span>
              {% endif %}

              <div class="d-flex">
                  <a href="{% url 'fijar-o-eliminar-habito' plato.es_lugar|yesno:'1,0' plato.objeto_id 'almuerzo' %}"
                  
                    title="{% if plato.fijo %}Eliminar hábito{% else %}Fijar hábito{% endif %}"
                    class="ms-2">
                    <i class="bi bi-pin-angle-fill fa-lg {% if plato.fijo %}text-success{% else %}text-secondary{% endif %}"></i>
                  </a>
                

                <a href="{% url 'eliminar-programado' plato.es_lugar|yesno:'1,0' plato.objeto_id 'almuerzo' dia %}"
                   class="btn btn-sm p-0 ms-2" title="Eliminar">
                  <i class="fa-solid fa-trash-can"></i>
                </a>
              </div>
            </div>

            {% if not plato.es_lugar and 'Principal' in plato.tipo %}
              <div class="ms-5">
                <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                        id="agregar-salsa-{{ plato.objeto_id }}">
                  + Salsa
                </button>
                <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                        id="agregar-guarnicion-{{ plato.objeto_id }}">
                  + Guarnición
                </button>
              </div>
            {% endif %}

          {% else %}
            <p class="mb-1 ms-1 d-flex align-items-center text-danger">
              Este objeto no tiene ID válido.
            </p>
          {% endif %}

        {% endfor %}
      {% else %}
        <p class="mb-1 ms-1 d-flex align-items-center">No hay platos programados.</p>
      {% endif %}
    </div>

    <!-- Merienda -->
    <div class="col-md-3">
      <h6 class="fw-bold ms-1 bg-primary text-white p-1 rounded">Merienda</h6>

      {% if dia_plato.1.merienda %}
        {% for plato in dia_plato.1.merienda %}

          {% if plato.objeto_id %}

            <div class="mb-1 ms-1 d-flex align-items-center text-primary justify-content-between">
              {% if not plato.es_lugar %}
                <a href="{% url 'videos-update' plato.objeto_id %}" class="text-decoration-none me-2 w-75">
                  &nbsp; {{ plato.nombre }}
                </a>
              {% else %}
                <span class="me-2 w-75">&nbsp; {{ plato.nombre }}</span>
              {% endif %}

              <div class="d-flex">
                  <a href="{% url 'fijar-o-eliminar-habito' plato.es_lugar|yesno:'1,0' plato.objeto_id 'merienda' %}"
                    title="{% if plato.fijo %}Eliminar hábito{% else %}Fijar hábito{% endif %}"
                    class="ms-2">
                    <i class="bi bi-pin-angle-fill fa-lg {% if plato.fijo %}text-success{% else %}text-secondary{% endif %}"></i>
                  </a>

                <a href="{% url 'eliminar-programado' plato.es_lugar|yesno:'1,0' plato.objeto_id 'merienda' dia %}"
                   class="btn btn-sm p-0 ms-2" title="Eliminar">
                  <i class="fa-solid fa-trash-can"></i>
                </a>
              </div>
            </div>

            {% if not plato.es_lugar and 'Principal' in plato.tipo %}
              <div class="ms-5">
                <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                        id="agregar-salsa-{{ plato.objeto_id }}">
                  + Salsa
                </button>
                <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                        id="agregar-guarnicion-{{ plato.objeto_id }}">
                  + Guarnición
                </button>
              </div>
            {% endif %}

          {% else %}
            <p class="mb-1 ms-1 d-flex align-items-center text-danger">
              Este objeto no tiene ID válido.
            </p>
          {% endif %}

        {% endfor %}
      {% else %}
        <p class="mb-1 ms-1 d-flex align-items-center">No hay platos programados.</p>
      {% endif %}
    </div>

    <!-- Cena -->
    <div class="col-md-3">
      <h6 class="fw-bold ms-1 bg-primary text-white p-1 rounded">Cena</h6>

      {% if dia_plato.1.cena %}
        {% for plato in dia_plato.1.cena %}

          {% if plato.objeto_id %}

            <div class="mb-1 ms-1 d-flex align-items-center text-primary justify-content-between">
              {% if not plato.es_lugar %}
                <a href="{% url 'videos-update' plato.objeto_id %}" class="text-decoration-none me-2 w-75">
                  &nbsp; {{ plato.nombre }}
                </a>
              {% else %}
                <span class="me-2 w-75">&nbsp; {{ plato.nombre }}</span>
              {% endif %}

              <div class="d-flex">
                  <a href="{% url 'fijar-o-eliminar-habito' plato.es_lugar|yesno:'1,0' plato.objeto_id 'cena' %}"
                    title="{% if plato.fijo %}Eliminar hábito{% else %}Fijar hábito{% endif %}"
                    class="ms-2">
                    <i class="bi bi-pin-angle-fill fa-lg {% if plato.fijo %}text-success{% else %}text-secondary{% endif %}"></i>
                  </a>

                <a href="{% url 'eliminar-programado' plato.es_lugar|yesno:'1,0' plato.objeto_id 'cena' dia %}"
                   class="btn btn-sm p-0 ms-2" title="Eliminar">
                  <i class="fa-solid fa-trash-can"></i>
                </a>
              </div>
            </div>

            {% if not plato.es_lugar and 'Principal' in plato.tipo %}
              <div class="ms-5">
                <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                        id="agregar-salsa-{{ plato.objeto_id }}">
                  + Salsa
                </button>
                <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                        id="agregar-guarnicion-{{ plato.objeto_id }}">
                  + Guarnición
                </button>
              </div>
            {% endif %}

          {% else %}
            <p class="mb-1 ms-1 d-flex align-items-center text-danger">
              Este objeto no tiene ID válido.
            </p>
          {% endif %}

        {% endfor %}
      {% else %}
        <p class="mb-1 ms-1 d-flex align-items-center">No hay platos programados.</p>
      {% endif %}
    </div>

  </div>
</div>

<!-- COMIENZO DE CAROUSEL -->


{# ========================= #}
{# MOBILE: Carousel 4 slides (1 comida por slide) #}
{# ========================= #}

<div class="d-block d-md-none">
  <div id="comidasCarousel-{{ dia|date:'Y-m-d' }}"
       class="carousel slide comidas-carousel"
       data-bs-touch="true"
       data-bs-wrap="true"
       data-bs-ride="false"
       data-bs-interval="false">

    <div class="carousel-inner">

      <!-- Slide 1: Desayuno -->
      <div class="carousel-item">
        <div class="p-1">
          <h6 class="fw-bold ms-1 bg-primary text-white p-1 rounded">Desayuno</h6>

          {% if dia_plato.1.desayuno %}
            {% for plato in dia_plato.1.desayuno %}
              {% if plato.objeto_id %}

                <div class="mb-1 ms-1 d-flex align-items-center text-primary">

                  <!-- Nombre (link solo si NO es lugar) -->
                  {% if not plato.es_lugar %}
                    <a href="{% url 'videos-update' plato.objeto_id %}"
                       class="text-decoration-none me-2">
                      &nbsp; {{ plato.nombre }}
                    </a>
                  {% else %}
                    <span class="me-2">&nbsp; {{ plato.nombre }}</span>
                  {% endif %}

                  <!-- Pin solo si NO es lugar -->
                    <a href="{% url 'fijar-o-eliminar-habito' plato.es_lugar|yesno:'1,0' plato.objeto_id 'desayuno' %}">

                       title="{% if plato.fijo %}Eliminar hábito{% else %}Fijar hábito{% endif %}">
                      <i class="bi bi-pin-angle-fill ms-2 fa-lg {% if plato.fijo %}text-success{% else %}text-secondary{% endif %}"></i>
                    </a>

                  <!-- Eliminar: manda es_lugar (1/0) + objeto_id -->
                  <a href="{% url 'eliminar-programado' plato.es_lugar|yesno:'1,0' plato.objeto_id 'desayuno' dia %}"
                     class="btn btn-sm p-0 ms-2" title="Eliminar">
                    <i class="fa-solid fa-trash-can"></i>
                  </a>

                </div>

                <!-- Extras SOLO si NO es lugar y es Principal -->
                {% if not plato.es_lugar and 'Principal' in plato.tipo %}
                  <div class="ms-4">
                    <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                            id="agregar-salsa-{{ plato.objeto_id }}">
                      + Salsa
                    </button>
                    <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                            id="agregar-guarnicion-{{ plato.objeto_id }}">
                      + Guarnición
                    </button>
                  </div>
                {% endif %}

              {% else %}
                <p class="mb-1 ms-1 d-flex align-items-center text-danger">
                  Este objeto no tiene ID válido.
                </p>
              {% endif %}
            {% endfor %}
          {% else %}
            <p class="mb-1 ms-1 d-flex align-items-center">No hay platos programados.</p>
          {% endif %}
        </div>
      </div>

      <!-- Slide 2: Almuerzo -->
      <div class="carousel-item active">
        <div class="p-1">
          <h6 class="fw-bold ms-1 bg-primary text-white p-1 rounded">Almuerzo</h6>

          {% if dia_plato.1.almuerzo %}
            {% for plato in dia_plato.1.almuerzo %}
              {% if plato.objeto_id %}

                <div class="mb-1 ms-1 d-flex align-items-center text-primary">

                  {% if not plato.es_lugar %}
                    <a href="{% url 'videos-update' plato.objeto_id %}"
                       class="text-decoration-none me-2">
                      &nbsp; {{ plato.nombre }}
                    </a>
                  {% else %}
                    <span class="me-2">&nbsp; {{ plato.nombre }}</span>
                  {% endif %}

                    <a href="{% url 'fijar-o-eliminar-habito' plato.es_lugar|yesno:'1,0' plato.objeto_id 'almuerzo' %}">
                       title="{% if plato.fijo %}Eliminar hábito{% else %}Fijar hábito{% endif %}">
                      <i class="bi bi-pin-angle-fill ms-2 fa-lg {% if plato.fijo %}text-success{% else %}text-secondary{% endif %}"></i>
                    </a>

                  <a href="{% url 'eliminar-programado' plato.es_lugar|yesno:'1,0' plato.objeto_id 'almuerzo' dia %}"
                     class="btn btn-sm p-0 ms-2" title="Eliminar">
                    <i class="fa-solid fa-trash-can"></i>
                  </a>

                </div>

                {% if not plato.es_lugar and 'Principal' in plato.tipo %}
                  <div class="ms-4">
                    <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                            id="agregar-salsa-{{ plato.objeto_id }}">
                      + Salsa
                    </button>
                    <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                            id="agregar-guarnicion-{{ plato.objeto_id }}">
                      + Guarnición
                    </button>
                  </div>
                {% endif %}

              {% else %}
                <p class="mb-1 ms-1 d-flex align-items-center text-danger">
                  Este objeto no tiene ID válido.
                </p>
              {% endif %}
            {% endfor %}
          {% else %}
            <p class="mb-1 ms-1 d-flex align-items-center">No hay platos programados.</p>
          {% endif %}
        </div>
      </div>

      <!-- Slide 3: Merienda -->
      <div class="carousel-item">
        <div class="p-1">
          <h6 class="fw-bold ms-1 bg-primary text-white p-1 rounded">Merienda</h6>

          {% if dia_plato.1.merienda %}
            {% for plato in dia_plato.1.merienda %}
              {% if plato.objeto_id %}

                <div class="mb-1 ms-1 d-flex align-items-center text-primary">

                  {% if not plato.es_lugar %}
                    <a href="{% url 'videos-update' plato.objeto_id %}"
                       class="text-decoration-none me-2">
                      &nbsp; {{ plato.nombre }}
                    </a>
                  {% else %}
                    <span class="me-2">&nbsp; {{ plato.nombre }}</span>
                  {% endif %}

                    <a href="{% url 'fijar-o-eliminar-habito' plato.es_lugar|yesno:'1,0' plato.objeto_id 'merienda' %}">
                       title="{% if plato.fijo %}Eliminar hábito{% else %}Fijar hábito{% endif %}">
                      <i class="bi bi-pin-angle-fill ms-2 fa-lg {% if plato.fijo %}text-success{% else %}text-secondary{% endif %}"></i>
                    </a>

                  <a href="{% url 'eliminar-programado' plato.es_lugar|yesno:'1,0' plato.objeto_id 'merienda' dia %}"
                     class="btn btn-sm p-0 ms-2" title="Eliminar">
                    <i class="fa-solid fa-trash-can"></i>
                  </a>

                </div>

                {% if not plato.es_lugar and 'Principal' in plato.tipo %}
                  <div class="ms-4">
                    <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                            id="agregar-salsa-{{ plato.objeto_id }}">
                      + Salsa
                    </button>
                    <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                            id="agregar-guarnicion-{{ plato.objeto_id }}">
                      + Guarnición
                    </button>
                  </div>
                {% endif %}

              {% else %}
                <p class="mb-1 ms-1 d-flex align-items-center text-danger">
                  Este objeto no tiene ID válido.
                </p>
              {% endif %}
            {% endfor %}
          {% else %}
            <p class="mb-1 ms-1 d-flex align-items-center">No hay platos programados.</p>
          {% endif %}
        </div>
      </div>

      <!-- Slide 4: Cena -->
      <div class="carousel-item">
        <div class="p-1">
          <h6 class="fw-bold ms-1 bg-primary text-white p-1 rounded">Cena</h6>

          {% if dia_plato.1.cena %}
            {% for plato in dia_plato.1.cena %}
              {% if plato.objeto_id %}

                <div class="mb-1 ms-1 d-flex align-items-center text-primary">

                  {% if not plato.es_lugar %}
                    <a href="{% url 'videos-update' plato.objeto_id %}"
                       class="text-decoration-none me-2">
                      &nbsp; {{ plato.nombre }}
                    </a>
                  {% else %}
                    <span class="me-2">&nbsp; {{ plato.nombre }}</span>
                  {% endif %}
                    <a href="{% url 'fijar-o-eliminar-habito' plato.es_lugar|yesno:'1,0' plato.objeto_id 'cena' %}">

                       title="{% if plato.fijo %}Eliminar hábito{% else %}Fijar hábito{% endif %}">
                      <i class="bi bi-pin-angle-fill ms-2 fa-lg {% if plato.fijo %}text-success{% else %}text-secondary{% endif %}"></i>
                    </a>

                  <a href="{% url 'eliminar-programado' plato.es_lugar|yesno:'1,0' plato.objeto_id 'cena' dia %}"
                     class="btn btn-sm p-0 ms-2" title="Eliminar">
                    <i class="fa-solid fa-trash-can"></i>
                  </a>

                </div>

                {% if not plato.es_lugar and 'Principal' in plato.tipo %}
                  <div class="ms-4">
                    <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                            id="agregar-salsa-{{ plato.objeto_id }}">
                      + Salsa
                    </button>
                    <button class="btn btn-link p-0 text-success" type="button" style="font-size: 10px;"
                            id="agregar-guarnicion-{{ plato.objeto_id }}">
                      + Guarnición
                    </button>
                  </div>
                {% endif %}

              {% else %}
                <p class="mb-1 ms-1 d-flex align-items-center text-danger">
                  Este objeto no tiene ID válido.
                </p>
              {% endif %}
            {% endfor %}
          {% else %}
            <p class="mb-1 ms-1 d-flex align-items-center">No hay platos programados.</p>
          {% endif %}
        </div>
      </div>

    </div>

    <!-- Controles -->
    <button class="carousel-control-prev" type="button"
            data-bs-target="#comidasCarousel-{{ dia|date:'Y-m-d' }}" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Anterior</span>
    </button>

    <button class="carousel-control-next" type="button"
            data-bs-target="#comidasCarousel-{{ dia|date:'Y-m-d' }}" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Siguiente</span>
    </button>

  </div>

  <!-- Indicador simple con links a cada slide -->
  <div class="text-center mt-1" style="font-size:.7rem;">
    <a href="#"
       class="text-muted mx-1"
       data-bs-target="#comidasCarousel-{{ dia|date:'Y-m-d' }}"
       data-bs-slide-to="0">
      Desayuno
    </a>
    ·
    <a href="#"
       class="text-muted mx-1"
       data-bs-target="#comidasCarousel-{{ dia|date:'Y-m-d' }}"
       data-bs-slide-to="1">
      Almuerzo
    </a>
    ·
    <a href="#"
       class="text-muted mx-1"
       data-bs-target="#comidasCarousel-{{ dia|date:'Y-m-d' }}"
       data-bs-slide-to="2">
      Merienda
    </a>
    ·
    <a href="#"
       class="text-muted mx-1"
       data-bs-target="#comidasCarousel-{{ dia|date:'Y-m-d' }}"
       data-bs-slide-to="3">
      Cena
    </a>
  </div>
</div>





<!-- FIN DEL CAROUSEL -->




                  {% endif %}
                {% endfor %}
              {% else %}
                <h3 class="text-muted text-center mt-1" style="font-size: 1rem;">
                  Aún no programaste ningún plato para este día.
                </h3>
              {% endif %}

            </div>
          </div>
        </div>

       <span class="menu-programado-badge position-absolute top-0 start-50 translate-middle">

    <span class="menu-programado-faja d-inline-flex align-items-center">

        <a href="/random-dia/{{ dia|date:'l'|slice:':2'|upper }}/"
           class="btn btn-sm text-danger p-0 me-1">
            <span class="material-symbols-outlined" style="font-size: 20px;">
                wand_shine
            </span>
        </a>

        <span class="menu-programado-text text-primary">
            Menú programado
        </span>

    {% if dia in platos_dia_x_dia %}
        <a href="#"
          data-bs-toggle="modal"
          data-bs-target="#confirmActionModal"
          data-confirm-title="Eliminar menú del día"
          data-confirm-body="¿Seguro querés borrar lo que comemos en este día?"
          data-confirm-action="{% url 'eliminar-menu-programado' %}"
          data-confirm-btn="Sí, borrar"
          title="Borrar menú del día"
          aria-label="Borrar menú del día"
          class="text-secondary text-decoration-none ali ms-1">
          <i class="bi bi-trash-fill fa-lg"></i>
        </a>
    </span>


    {% endif %}
</span>


        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-info">{{ message }}</div>
          {% endfor %}
        {% endif %}

      </div>
    </div>
  </div>
  {% endfor %}

  <div class="border border-primary rounded p-2 position-relative m-2">
    <small class="position-absolute top-0 start-50 translate-middle bg-white px-3 text-primary"
           style="transform: translate(-50%, -50%);">
      Platos
    </small>

    <div class="shadow rounded p-2 m-2 mb-0">
      {% block filtro %}{% endblock %}
    </div>

    <div class="my-3">
      {% block principal %}{% endblock %}
    </div>
  </div>

</div>

<!-- FIN DE PESTAÑAS - MENÚES PROGRAMADOS - PLATOS -->

{% endblock %}
