{% extends "AdminVideos/index.html" %}

{% load static %}

{% block lista_platos %}

{% comment %}

<!-- ESTE ES EL BOT√ìN DE AGREGAR -->
<section class="w-100 text-white">
  <div class="container">
    <div class="d-flex justify-content-center flex-wrap gap-3">

      <!-- COMENTO POR AHORA PERO CUANDO LO SAQUE, SACAR TODA LA LOGICA QUE CARGA FORMULARIO EN MODAL -->
       <!-- <button class="btn btn-primary" id="btnNuevoPrincipal">
        Nuevo Plato Principal
      </button>  -->

      <!-- % with tipopag=request.GET.tipopag %} -->
      {% if tipopag == "Delivery" or tipopag == "Comerafuera" %}
        <a class="btn btn-outline-primary w-100 rounded text-center fw-semibold py-2"

          href="{% url 'crear-lugar' %}?tipopag={{ tipopag|default:'Dash' }}">
          {% if tipopag and tipopag != "Dash" %}
            + AGREGAR {{ tipopag|upper}}
          {% else %}
            + AGREGAR PLATO PRINCIPAL
          {% endif %}
        </a>

      
      {% else %}
        <a class="btn btn-outline-primary w-100 rounded text-center fw-semibold py-2"
          href="{% url 'videos-create' %}?tipopag={{ tipopag|default:''|urlencode }}&return_to={{ request.get_full_path|urlencode }}">
          

      {% if tipopag and tipopag != "Dash" %}
            + AGREGAR RECETA DE {{ tipopag|upper }}

          {% else %}
            + AGREGAR RECETA DE PLATO PRINCIPAL
          {% endif %}
        </a>

      {% endif %}
    </div>
  </div>
</section>

{% endcomment %}

<!-- <H5>{{platos_compartidos}}  </H5> -->

<!-- ESTAS SON LAS TARJETAS DE COMPARTIDOS -->
<section class="w-100 py-2">
  <div class="container">
      
          {% if platos_compartidos %}


          <div class="d-flex flex-wrap gap-2 justify-content-center text-center">
            {% for plato_compartido in platos_compartidos %}
              <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                <div class="card h-100">
          
                  <img src="{{ plato_compartido.image_url }}" class="img-thumbnail" alt="Imagen">
          
                  <div class="card-body text-center">
                    <div class="position-absolute top-0 mt-1 start-50 translate-middle-x text-center text-white bg-dark rounded">
                      <h6 class="mb-0 small">{{ plato_compartido.nombre_plato }} de {{ plato_compartido.quien_comparte }}</h6>
                    </div>
          
                    <h6>{{ plato_compartido.mensaje }}</h6>
          
                    <div class="d-flex gap-1 align-items-center justify-content-center">
                      <a class="btn btn-primary btn-sm" href="{% url 'agregar-plato-compartido' plato_compartido.id_plato plato_compartido.mensaje_id %}">Agregar a mi lista</a>
                      <a class="btn btn-primary btn-sm" href="">Rechazar</a>
                    </div>
                  </div>
          
                </div>
              </div>
            {% endfor %}
          </div>
          




          {% endif %}
      
  </div>
</section>


<!-- ===========================
     SECCI√ìN: PLATOS EN CAROUSEL (PADRE + VARIEDADES ANIDADAS)
     - Sin scroll horizontal
     - Padre en card principal
     - Variedades en mini-grilla debajo
=========================== -->

{% if platos %}
<section class="w-100 bg-warning rounded shadow-sm p-3 mb-3">

  <div id="platosCarousel" class="carousel slide comidas-carousel" data-bs-ride="false" data-bs-interval="false">

    <!-- Indicadores (1 por grupo/padre) -->
    <div class="carousel-indicators">
      {% for grupo in platos %}
        <button type="button"
                data-bs-target="#platosCarousel"
                data-bs-slide-to="{{ forloop.counter0 }}"
                class="{% if forloop.first %}active{% endif %}"
                aria-current="{% if forloop.first %}true{% endif %}"
                aria-label="Grupo {{ forloop.counter }}">
        </button>
      {% endfor %}
    </div>

    <div class="carousel-inner">

      {% for grupo in platos %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
          <div class="d-flex justify-content-center py-2">

            <div class="w-100" style="max-width: 720px;">

              {# ===== CARD PRINCIPAL (PADRE o plato √∫nico) ===== #}
              <div class="card position-relative">

                <a href="#"
                   data-bs-toggle="modal"
                   data-bs-target="#asignarPlatoModal"
                   onclick="setPlatoInfo('{{ grupo.id }}', 'plato', '{{ grupo.nombre_plato }}')"
                   class="text-decoration-none plato-carousel-thumb">

                  <img src="{{ grupo.image_url }}"
                       class="
                       {% if user.id == grupo.propietario.id and not grupo.proviene_de %}
                         sombra-verde
                       {% elif user.id == grupo.propietario.id and grupo.proviene_de %}
                         sombra-naranja
                       {% else %}
                         sombra-violeta
                       {% endif %}"
                       alt="Imagen del Plato">

                  <!-- + central -->
                  <!-- <div class="plato-carousel-plus text-success">
                    <i class="fa-solid fa-plus-circle"></i>
                  </div> -->

                   <!-- + central -->
                  <div class="plato-plus">
                    <span>Programar</span>
                  </div>
                </a>

                {# Badge uso #}
                {% if grupo.ultima_programacion %}
                  <span class="badge bg-secondary position-absolute top-0 start-0 m-2">
                    Hace {{ grupo.dias_desde_ultima }} d√≠a{% if grupo.dias_desde_ultima != 1 %}s{% endif %}
                  </span>
                {% else %}
                  <span class="badge bg-success position-absolute top-0 start-0 m-2">
                    Nunca usado
                  </span>
                {% endif %}

                {# Badge folder si tiene variedades #}
                {% if grupo.variedades_count > 0 %}
                  <span class="badge bg-dark position-absolute top-0 end-0 m-2">
                    üìÅ {{ grupo.variedades_count|add:"1" }}
                  </span>
                {% endif %}

                <div class="card-body">

                  <h5 class="card-title text-center mb-2">
                    {% if grupo.variedades_count > 0 %}
                      {{ grupo.nombre_para_front }}
                    {% else %}
                      {{ grupo.nombre_plato }}
                    {% endif %}
                  </h5>

                  <!-- Acciones -->
                  <div class="d-flex flex-wrap justify-content-center gap-2">

                    <a href="#"
                       class="btn btn-sm btn-outline-primary js-plato-ingredientes"
                       data-url="{% url 'plato_ingredientes' grupo.id %}">
                      <i class="fa-solid fa-list-check me-1"></i> Ingredientes
                    </a>

                    {% if amigues %}
                    <a href="#"
                       class="btn btn-sm btn-outline-secondary"
                       data-bs-toggle="modal"
                       data-bs-target="#compartirModal"
                       onclick="setPlatoInfo('{{ grupo.id }}', 'plato')">
                      <i class="fa-solid fa-share-nodes me-1"></i> Compartir
                    </a>
                    {% endif %}

              {% if grupo.propietario == request.user %}
                <!-- Bot√≥n Editar: navegaci√≥n normal -->
                <!-- <a href="% url 'videos-update' grupo.id %}"
                  class="btn btn-sm btn-outline-dark">
                  <i class="fa-regular fa-pen-to-square me-1"></i> Editar
                </a> -->

                <a href="{% url 'videos-update' grupo.id %}?return_to={{ request.get_full_path|urlencode }}"
                  class="btn btn-sm btn-outline-dark">
                  <i class="fa-regular fa-pen-to-square me-1"></i> Editar
                </a>


                <a href="#"
                  class="btn btn-sm btn-outline-danger"
                  data-bs-toggle="modal"
                  data-bs-target="#confirmActionModal"
                  data-confirm-title="Eliminar plato"
                  data-confirm-body="¬øSeguro que quer√©s borrar <strong>{{ grupo.nombre_plato|escape }}</strong>?"
                  data-confirm-hint="Tambi√©n se borrar√°n las programaciones de este plato. Esta acci√≥n no se puede deshacer."
                  data-confirm-action="{% url 'eliminar-plato' grupo.id %}"
                  data-confirm-btn="S√≠, borrar">
                  <i class="fa-solid fa-trash-can me-1"></i> Eliminar
                </a>



              {% else %}
                <!-- Bot√≥n Ver: abre modal -->
                <a href="#"
                  class="btn btn-sm btn-outline-dark js-ver-detalle-plato"
                  data-detail-url="{% url 'platos-detail' grupo.id %}"
                  title="Ver detalle">
                  <i class="fa-regular fa-eye me-1"></i> Ver
                </a>
              {% endif %}
              
                  </div>

                  {# ===== VARIEDADES ANIDADAS (MINI GRILLA) ===== #}
                  {% if grupo.variedades_hijas.all %}
                    {% if grupo.variedades_count > 0 %}
                      <hr class="my-3">

                      <div class="small text-muted text-center mb-2">
                        Variedades
                      </div>

                      <div class="row g-2">
                        {% for v in grupo.variedades_hijas.all %}
                          <div class="col-6 col-md-4">
                            <div class="card h-100 border">

                              <a href="#"
                                 data-bs-toggle="modal"
                                 data-bs-target="#asignarPlatoModal"
                                 onclick="setPlatoInfo('{{ v.id }}', 'plato', '{{ v.nombre_plato }}')"
                                 class="text-decoration-none plato-mini-thumb">

                                <img src="{{ v.image_url }}"
                                     class="w-100"
                                     alt="Imagen variedad">
                                <div class="plato-mini-plus text-success">
                                  <i class="fa-solid fa-plus-circle"></i>
                                </div>
                              </a>

                              <div class="p-2">
                                <div class="text-center fw-semibold" style="font-size:.85rem; line-height:1.1;">
                                  {{ v.nombre_plato }}
                                </div>

                                <div class="d-flex justify-content-center gap-1 flex-wrap mt-2">
                                  <a href="#"
                                     class="btn btn-sm btn-outline-primary py-0 px-2 js-plato-ingredientes"
                                     data-url="{% url 'plato_ingredientes' v.id %}"
                                     title="Ingredientes">
                                    <i class="fa-solid fa-list-check"></i>
                                  </a>

                                  {% if grupo.propietario == request.user %}

                                    <a href="{% url 'videos-update' v.id %}?return_to={{ request.get_full_path|urlencode }}
"
                                      class="btn btn-sm btn-outline-dark py-0 px-2"
                                      title="Editar">
                                      <i class="fa-regular fa-pen-to-square"></i>
                                    </a>

                                    <a href="#"
                                      class="btn btn-sm btn-outline-danger py-0 px-2"
                                      data-bs-toggle="modal"
                                      data-bs-target="#confirmActionModal"
                                      data-confirm-title="Eliminar plato"
                                      data-confirm-body="¬øSeguro que quer√©s borrar <strong>{{ v.nombre_plato|escape }}</strong>?"
                                      data-confirm-hint="Tambi√©n se borrar√°n las programaciones de este plato. Esta acci√≥n no se puede deshacer."
                                      data-confirm-action="{% url 'eliminar-plato' v.id %}"
                                      data-confirm-btn="S√≠, borrar"
                                      title="Eliminar">
                                      <i class="fa-solid fa-trash-can"></i>
                                    </a>

                                  {% else %}
                                  <!-- Bot√≥n Ver: abre modal -->
                                  <a href="#"
                                    class="btn btn-sm btn-outline-dark js-ver-detalle-plato"
                                    data-detail-url="{% url 'platos-detail' grupo.id %}"
                                    title="Ver detalle">
                                    <i class="fa-regular fa-eye me-1"></i> Ver
                                  </a>
                                {% endif %}

                                </div>

                                {% if v.ultima_programacion %}
                                  <div class="text-center text-muted mt-2" style="font-size:.75rem;">
                                    Hace {{ v.dias_desde_ultima }} d√≠a{% if v.dias_desde_ultima != 1 %}s{% endif %}
                                  </div>
                                {% else %}
                                  <div class="text-center text-success mt-2" style="font-size:.75rem;">
                                    Nunca usado
                                  </div>
                                {% endif %}
                              </div>
                            </div>
                          </div>
                        {% endfor %}
                      </div>
                    {% endif %}
                  {% endif %}

                </div>
              </div>

            </div>
          </div>
        </div>
      {% endfor %}

    </div>

    <!-- Controles -->
    <button class="carousel-control-prev" type="button"
            data-bs-target="#platosCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
      <span class="visually-hidden">Anterior</span>
    </button>

    <button class="carousel-control-next" type="button"
            data-bs-target="#platosCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
      <span class="visually-hidden">Siguiente</span>
    </button>

  </div>
</section>              
{% elif tipopag != "Delivery" and tipopag != "Comerafuera"%}
  <div class="alert alert-info text-center" role="alert">
        <i class="bi bi-geo-alt-fill"></i> No hay {{tipopag}} ingresados para mostrar.
  </div>
{% endif %}

 
<!-- LISTA TIPO GMAIL (PLATOS) -->
<section class="w-100 text-white bg-light rounded shadow-sm">

  <!-- Header opcional (tipo Gmail: checkbox + t√≠tulos) -->
  <div class="px-2 py-2 border-bottom d-flex align-items-center gap-2 text-dark">
    <input class="form-check-input" type="checkbox" id="chk-platos-all" aria-label="Seleccionar todos">
    <div class="flex-grow-1 small text-muted">Platos</div>
    <div class="small text-muted d-none d-md-block">Acciones</div>
  </div>

  <div class="list-group list-group-flush">

    {% for plato in platos %}


    <div class="list-group-item text-dark px-2 py-2 border-bottom border-secondary-subtle list-group-item-action plato-row"
      data-row
      data-plato-id="{{ plato.id }}">

   
        <div class="d-flex align-items-center gap-2">

          <!-- Checkbox -->
          <div class="form-check m-0">
            <input class="form-check-input js-plato-select"
              type="checkbox"
              name="platos_selected"
              value="{{ plato.id }}">

          </div>


          <!-- Thumb chico (abre asignarPlatoModal como antes) -->
          <div class="flex-shrink-0">
            <a href="#"
               data-bs-toggle="modal"
               data-bs-target="#asignarPlatoModal"
               onclick="setPlatoInfo('{{ plato.id }}', 'plato', '{{ plato.nombre_plato }}')"
               class="d-inline-block text-decoration-none">

              <img src="{{ plato.image_url }}"
                   style="width: 38px; height: 38px; object-fit: cover; border-radius: 8px;"
                   class="
                   {% if user.id == plato.propietario.id and not plato.proviene_de %}
                     sombra-verde
                   {% elif user.id == plato.propietario.id and plato.proviene_de %}
                     sombra-naranja
                   {% else %}
                     sombra-violeta
                   {% endif %}"
                   alt="Imagen del Plato">
            </a>
          </div>

          <!-- Centro: nombre + badge -->
          <div class="flex-grow-1 min-w-0">

            <div class="d-flex align-items-center gap-2 min-w-0">

              <!-- Nombre (trunca como lista de mails) -->
              <div class="fw-semibold text-truncate">
                {% if plato.variedades_count > 0 %}
                  {{ plato.nombre_para_front }}
                {% else %}
                  {{ plato.nombre_plato }}
                {% endif %}
              </div>

              <!-- Badge variedades -->
              {% if plato.variedades_count > 0 %}
                <span class="badge rounded-pill bg-secondary-subtle text-dark flex-shrink-0">
                  üìÅ {{ plato.variedades_count|add:"1" }}
                </span>
              {% endif %}

            </div>

            <!-- Sub-l√≠nea opcional (si quer√©s meter meta info) -->
            {# <div class="small text-muted text-truncate">Alg√∫n dato extra...</div> #}

          </div>

          <!-- Acciones (desktop) -->
          <div class="d-none d-md-flex align-items-center gap-1 flex-shrink-0">

            {% if amigues %}
              <a href="#"
                 data-bs-toggle="modal"
                 data-bs-target="#compartirModal"
                 onclick="setPlatoInfo('{{ plato.id }}', 'plato')"
                 class="btn btn-sm btn-outline-primary"
                 title="Compartir"
                 aria-label="Compartir">
                <i class="fa-solid fa-share-nodes"></i>
              </a>
            {% endif %}

            <a href="#"
               class="btn btn-sm btn-outline-primary js-plato-ingredientes"
               data-url="{% url 'plato_ingredientes' plato.id %}"
               title="Compartir lista de ingredientes"
               aria-label="Ingredientes">
              <i class="fa-solid fa-list-check"></i>
            </a>

            {% if plato.propietario == request.user %}
              <a href="{% url 'videos-update' plato.id %}?return_to={{ request.get_full_path|urlencode }}{% if tipopag %}&tipopag={{ tipopag|urlencode }}{% endif %}"
                 class="btn btn-sm btn-outline-dark"
                 title="Editar"
                 aria-label="Editar">
                <i class="fa-regular fa-pen-to-square"></i>
              </a>
            {% else %}
              <a href="#"
                 class="btn btn-sm btn-outline-secondary js-ver-detalle-plato"
                 data-detail-url="{% url 'platos-detail' plato.id %}"
                 title="Ver detalle"
                 aria-label="Ver detalle">
                <i class="fa-regular fa-eye"></i>
              </a>
            {% endif %}

            <a href="#"
               data-bs-toggle="modal"
               data-bs-target="#confirmActionModal"
               data-confirm-title="Eliminar plato"
               data-confirm-body="¬øSeguro que quer√©s borrar <strong>{{ plato.nombre_plato|escape }}</strong>?"
               data-confirm-hint="Tambi√©n se borrar√°n las programaciones de este plato.<br> Esta acci√≥n no se puede deshacer."
               data-confirm-action="{% url 'eliminar-plato' plato.id %}"
               data-confirm-btn="S√≠, borrar"
               class="btn btn-sm btn-outline-secondary"
               title="Eliminar"
               aria-label="Eliminar plato">
              <i class="fa-solid fa-trash-can"></i>
            </a>

          </div>

          <!-- Men√∫ ‚ãØ (mobile / fallback) -->
          <div class="dropdown d-md-none flex-shrink-0">
            <button class="btn btn-sm btn-light py-0 px-3"
                    type="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                    title="Opciones"
                    aria-label="Opciones">
              <i class="fa-solid fa-ellipsis-vertical"></i>
            </button>

            <ul class="dropdown-menu dropdown-menu-end">

              <li>
                <a class="dropdown-item"
                   href="#"
                   class="js-plato-ingredientes"
                   data-url="{% url 'plato_ingredientes' plato.id %}">
                  <i class="fa-solid fa-list-check me-2"></i> Ingredientes
                </a>
              </li>

              {% if plato.propietario == request.user %}
                <li>
                  <a class="dropdown-item"
                     href="{% url 'videos-update' plato.id %}?return_to={{ request.get_full_path|urlencode }}{% if tipopag %}&tipopag={{ tipopag|urlencode }}{% endif %}">
                    <i class="fa-solid fa-pen-to-square me-2"></i> Editar
                  </a>
                </li>
              {% else %}
                <li>
                  <a class="dropdown-item js-ver-detalle-plato"
                     href="#"
                     data-detail-url="{% url 'platos-detail' plato.id %}">
                    <i class="fa-solid fa-eye me-2"></i> Ver detalle
                  </a>
                </li>
              {% endif %}

              {% if amigues %}
                <li>
                  <a class="dropdown-item"
                     href="#"
                     data-bs-toggle="modal"
                     data-bs-target="#compartirModal"
                     onclick="setPlatoInfo('{{ plato.id }}', 'plato')">
                    <i class="fa-solid fa-share-nodes me-2"></i> Compartir
                  </a>
                </li>
              {% endif %}

              <li><hr class="dropdown-divider"></li>

              <li>
                <a class="dropdown-item text-danger"
                   href="#"
                   data-bs-toggle="modal"
                   data-bs-target="#confirmActionModal"
                   data-confirm-title="Eliminar plato"
                   data-confirm-body="¬øSeguro que quer√©s borrar <strong>{{ plato.nombre_plato|escape }}</strong>?"
                   data-confirm-hint="Tambi√©n se borrar√°n las programaciones de este plato. Esta acci√≥n no se puede deshacer."
                   data-confirm-action="{% url 'eliminar-plato' plato.id %}"
                   data-confirm-btn="S√≠, borrar">
                  <i class="fa-solid fa-trash-can me-2"></i> Eliminar
                </a>
              </li>

            </ul>
          </div>

        </div>
      </div>

    {% endfor %}

  </div>
</section>



<!-- ESTAS SON LAS TARJETAS DE LUGARES, SI ES QUE ESTAMOS EN LUGARES -->
<section class="w-100 bg-info text-white">
  {% if tipopag == "Delivery" or tipopag == "Comerafuera" %}
    {% if not lugares %}
      <div class="alert alert-info text-center" role="alert">
        <i class="bi bi-geo-alt-fill"></i> No hay lugares ingresados para mostrar.
      </div>
    {% else %}
      <div class="container p-0">
        <div class="row">
          {% for lugar in lugares %}
            <div class="col-6 col-sm-4 col-md-3">
                <div class="card h-100 shadow-sm rounded-4" style="font-size: 0.9rem; position: relative;">
                  <a href="{% url 'lugar-detail' lugar.id %}" style="position: relative; display: block;">
                    <img src="{{ lugar.image_url }}" class="card-img-top object-fit-cover rounded-top-4" alt="Imagen del Lugar"
                      style="height: 150px; object-fit: cover;">
                    <div
                      style="position: absolute; top: 0; left: 0; right: 0; height: 150px; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.4); color: white; font-weight: bold; border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
                      {{ lugar.nombre }}
                    </div>
                  </a>

                  <div class="card-body text-center p-1">
                    <p class="text-muted mb-0" style="font-size: 0.8rem;">{{ lugar.direccion|default:"Sin direcci√≥n" }}</p>

                    {% if amigues %}
                      <div class="mt-2">
                        <a href="#" data-bs-toggle="modal" data-bs-target="#compartirModal"
                          onclick="setPlatoInfo('{{ lugar.id }}', 'lugar')" class="text-primary me-2">
                          <i class="fa-solid fa-share-nodes"></i>
                        </a>
                      </div>
                    {% endif %}
                    
                    <a href="#"
                      data-bs-toggle="modal"
                      data-bs-target="#asignarPlatoModal"
                      onclick="setPlatoInfo('{{ lugar.id }}', 'lugar')"
                      class="btn btn-sm btn-primary p-0">
                      Programar
                    </a>


                  </div>
                </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  {% endif %}
</section>

{% comment %}

{% endwith %}

{% endcomment %}


  <!-- Modal para compartir plato -->
  <div class="modal fade" id="compartirModal" tabindex="-1" aria-labelledby="compartirModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <!-- <div class="modal-header">
        <h5 class="modal-title" id="compartirModalLabel">Compartir plato</h5>
        
      </div> -->
        <div class="modal-body">
          <form method="post" action="{% url 'compartir-plato' %}">
            {% csrf_token %}

            <div class="mb-3">
              <h6>Compartir con:</h6>
              <select id="amigue-select" name="amigue" class="form-select" aria-label="Seleccionar amigue">
                {% for amigue in amigues %}
                <option value="{{ amigue }}">{{ amigue }}</option>
                {% endfor %}
              </select>
              <!-- Campo oculto donde se establecer√° el plato id din√°micamente -->
              <input type="hidden" name="id_elemento" id="platoIdInputCompartir">

              <!-- Campo oculto para el tipo de elemento -->
              <input type="hidden" name="tipo_elemento" id="tipoObjetoCompartir">

            </div>

            <button type="submit" class="btn btn-primary">Compartir</button>

            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>

          </form>
        </div>
      </div>
    </div>
  </div>


{% comment %}
 Modal para cargar el formulario din√°micamente 
 <div class="modal fade" id="modalPlato" tabindex="-1" aria-labelledby="modalPlatoLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalPlatoLabel">Nuevo Plato</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body" id="modalPlatoBody">
        Aqu√≠ se cargar√° el formulario din√°micamente 
      </div>
    </div>
  </div>
</div> 

 
TODO: reactivar modalPlato cuando volvamos a cargar el form en modal (btnNuevoPrincipal / btn-editar-plato)
<script>
document.addEventListener("DOMContentLoaded", function() {
  const modalEl = document.getElementById("modalPlato");
  const modalBody = document.getElementById("modalPlatoBody");
  const modal = new bootstrap.Modal(modalEl);

  const btnNuevo = document.getElementById("btnNuevoPrincipal");
  if (!btnNuevo) return;

  btnNuevo.addEventListener("click", function() {
    fetch("{% url 'videos-create' %}?tipopag=Principal", {
      headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(r => r.json())
    .then(data => {
      modalBody.innerHTML = data.html;
      // üëá Nueva l√≠nea clave: inicializa todas las funciones JS del form
      initPlatoForm(modalBody);
      modal.show();
    })
    .catch(err => console.error("Error cargando formulario:", err));
  });
});
</script> 


TODO: modalPlato desactivado por ahora (se reactivar√° cuando usemos btnNuevoPrincipal / btn-editar-plato)

<script>
document.addEventListener("DOMContentLoaded", function () {
  const modal = new bootstrap.Modal(document.getElementById("modalPlato"));
  const modalBody = document.getElementById("modalPlatoBody");
  const modalTitle = document.getElementById("modalPlatoLabel");

  // üëâ Bot√≥n "Editar"
  document.querySelectorAll(".btn-editar-plato").forEach(btn => {
    btn.addEventListener("click", function (e) {
      e.preventDefault();
      const url = this.getAttribute("data-url");
      const nombre = this.getAttribute("data-nombre");

      fetch(url, {
        headers: { "X-Requested-With": "XMLHttpRequest" }
      })
        .then(response => response.json())
        .then(data => {
          modalBody.innerHTML = data.html;
          modalTitle.textContent = "Editar: " + nombre;
          initPlatoForm(modalBody);
          modal.show();
        })
        .catch(err => {
          console.error("Error cargando formulario de edici√≥n:", err);
        });
    });
  });
});
</script>
{% endcomment %}

<script>
// ==========================================
// FILAS TIPO GMAIL (selecci√≥n de platos)
// - Cuando tild√°s/destild√°s el checkbox de un plato,
//   marca/desmarca visualmente toda la fila.
// - Se apoya en una clase de estado: "is-selected"
//   (para que el CSS pinte el fondo).
// - Usa delegaci√≥n de eventos: funciona aunque la lista
//   se renderice/inserte por AJAX.
// - Inicializa el estado al cargar (por si hay checks ya marcados).
// ==========================================
(function () {
  function sync(chk) {
    const row = chk.closest("[data-row]");
    if (!row) return;
    row.classList.toggle("is-selected", chk.checked);
  }

  // Inicializa el estado visual al cargar
  document.querySelectorAll("input.js-plato-select").forEach(sync);

  // Cambios de checkbox (delegado)
  document.addEventListener("change", (ev) => {
    const chk = ev.target.closest("input.js-plato-select");
    if (!chk) return;
    sync(chk);
  });
})();

</script>



{% endblock %}