<div class="modal fade" id="platoIngredientesModal" tabindex="-1" aria-hidden="true"
     data-api-toggle="{% url 'api-toggle-item' token=api_token %}">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Ingredientes: {{ plato.nombre_plato }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <form id="frm-plato-ingredientes" method="post" action="">
        {% csrf_token %}

        <div class="modal-body">
          {% if items %}
                  <h6 class="mb-1">Marc√° lo que necesites comprar:</h6>

            <ul class="list-group">
              {% for item in items %}
                <li class="list-group-item">
                  <div class="d-flex flex-column gap-2">

                    <div class="d-flex align-items-start justify-content-between gap-2">
                      <div class="form-check m-0 flex-grow-1">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="ing-{{ item.ingrediente_id }}"
                          name="ingrediente_a_comprar_id"
                          value="{{ item.ingrediente_id }}"
                          {% if item.estado == "no-tengo" %}checked{% endif %}
                        >
                        <label class="form-check-label fw-semibold" for="ing-{{ item.ingrediente_id }}">
                          {{ item.nombre }}
                        </label>
                      </div>

                      <small class="text-muted">
                        {{ item.cantidad }} {{ item.unidad }}
                      </small>
                    </div>

                    <div class="input-group input-group-sm">
                     
                      <input
                        type="text"
                        class="form-control"
                        name="comentario_{{ item.ingrediente_id }}"
                        value="{{ item.comentario }}"
                        placeholder="Comentario"
                        data-ing-nombre="{{ item.nombre|escapejs }}"
                      >

                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        onclick="const el=this.previousElementSibling; el.value=''; el.dispatchEvent(new Event('input',{bubbles:true})); el.dispatchEvent(new Event('change',{bubbles:true}));"
                        title="Limpiar comentario"
                      >
                        &times;
                      </button>

                    </div>

                  </div>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <div class="alert alert-secondary mb-0">
              Este plato no tiene ingredientes cargados.
            </div>
          {% endif %}

          <hr class="my-3">

          <div class="d-grid gap-2">
            <a class="btn btn-success" target="_blank"
              href="https://wa.me/?text={{ share_url|urlencode }}">
              Compartir por WhatsApp
            </a>

            <button type="button" class="btn btn-outline-secondary" id="btnCopyLink"
                    data-link="{{ share_url }}">
              Copiar link
            </button>
          </div>
        </div>
      </form>

    </div>
  </div>
</div>

