{% extends "AdminVideos/base.html" %}

{% load static %}

{% block principal %}

<div class="row">
    <div class="col-md-4">
        <h5 >ingredientes_separados_por_comas {{ingredientes_separados_por_comas}}</h5> 
        <h5 >lista_de_ingredientes {{lista_de_ingredientes}}</h5> 

       <h5 >LOS platos por día {{platos_por_dia}}</h5> 
<!-- 
        <h5 >el request {{el_request}}</h5>

        <h5 >dia en que comemor str /{{dia_en_que_comemos_str}}/</h5>
        <h5 >buscar cena por día /{{buscar_cena_por_dia}}/</h5>
        <h5 >claves en el request /{{claves_en_el_request}}/</h5> -->

    <section>
        <h4>Menúes Programados</h4>

        <form action="{% url 'menu-elegido' %}" method="post">
            {% csrf_token %}
        
            {% for fecha, platos in platos_por_dia.items %}
            <div class="card">
                <div class="card-body">
                 
        
                    <h5 class="bg-primary text-white p-2 rounded">{{ fecha }}</h5> <!-- Fondo azul con texto blanco -->
        
                    {% for plato_id, datos in platos.items %}
                        <div class="form-check">
                            <input 
                                type="checkbox" 
                                id="plato{{ plato_id }}_{{ fecha|date:'Ymd' }}" 
                                name="plato_seleccionado" 
                                value="{{ plato_id }}" 
                                class="form-check-input"
                                {% if datos.elegido %} checked {% endif %}
                            >
                            <label for="plato{{ plato_id }}_{{ fecha|date:'Ymd' }}" class="form-check-label">
                                {{ datos.plato }} - {{ datos.tipo }} ({{ datos.comida }})
                            </label>
                            <p class="small text-muted">{{ datos.ingredientes }}</p>
                        </div>
        
                        <!-- Recorrer variedades si existen -->
                        {% if datos.variedades %}
                            <div class="ml-4">
                                {% for variedad_id, variedad in datos.variedades.items %}
                                    <div class="form-check">
                                        <input 
                                            type="checkbox" 
                                            id="variedad{{ variedad_id }}_{{ plato_id }}_{{ fecha|date:'Ymd' }}" 
                                            name="variedad_seleccionada" 
                                            value="{{ plato_id }}|{{ variedad.nombre }}" 
                                            class="form-check-input"
                                            {% if variedad.elegido %} checked {% endif %}
                                        >
                                        <label for="variedad{{ variedad_id }}_{{ plato_id }}_{{ fecha|date:'Ymd' }}" class="form-check-label">
                                            → {{ variedad.nombre }} ({{ variedad.ingredientes }})
                                        </label>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
        
                    {% endfor %}
                </div>
            </div>
            {% empty %}
            <p>No hay platos asignados.</p>
            {% endfor %}
        
</section>

</div>



<div class="col-md-4">

            <h3>EDITA LISTA DE COMPRAS</h3>
                
                    {% if ingredientes_separados_por_comas %}
                        {% for ingrediente, valor  in ingredientes_separados_por_comas.items %}
                            <input type="checkbox" id="{{ ingrediente }}" name="ingrediente_a_comprar" value="{{ ingrediente }}"  {% if valor.estado == "no-tengo" %} checked {% endif %}>
                        
                            <label for="{{ ingrediente }}">{{ ingrediente }}</label>
                            <input type="search"  class="DocSearch-Input" id="{{ ingrediente }}_detalle" value="{{ valor.comentario }}" name="{{ ingrediente }}_detalle">

                            <br>
                        {% endfor %}
                    {% else %}
                    <div class="badge bg-primary text-wrap" style="width: 6rem;">
                        NO HAY INGREDIENTES PARA EDITAR
                      </div>
                    {% endif %}
                                    
</div>

<div class="col-md-4">
    <section>
        <H3>LISTA DE COMPRAS</H3>
        {% if lista_de_compras %}
          <ul>
            {% for item in lista_de_compras %}
              <li>{{ item }}</li>
            {% endfor %} 

            <a href="https://wa.me/5491145342640?text={{ mensaje_whatsapp }}" target="_blank">Enviar lista por WhatsApp</a>

          </ul>

        {% else %}
          <div class="badge bg-primary text-wrap" style="width: 6rem;">
            NO HAY INGREDIENTES PARA COMPRAR
          </div>
        {% endif %}

    </section>
</div>

<input type="submit" value="Actualizar" class="btn btn-success">

</form>


{% endblock %}